<?xml version="1.0" encoding="UTF-8"?>
<project name="Upfit" basedir="." default="check">

    <property file="build.properties" />

    <target name="composer:self-update">
        <composer command="self-update" composer="${path.composer}" php="${path.php}"/>
    </target>

    <target name="composer:update"
            depends="composer:self-update">
        <composer command="update" composer="${path.composer}" php="${path.php}"/>
    </target>

    <target name="composer:install"
            depends="composer:self-update">
        <composer command="install" composer="${path.composer}" php="${path.php}">
            <arg value="--no-dev" />
            <arg value="--optimize-autoloader" />
        </composer>
    </target>

    <target name="check:style">
        <exec command="${path.php} bin/phpcs -p --standard=PSR2 --extensions=php src/"
                passthru="true"
                checkreturn="true"/>
    </target>

    <target name="check:lint"
            depends="check:lint:twig,check:lint:php">
    </target>

    <target name="check:lint:twig">
        <SymfonyConsole command="twig:lint">
            <arg value="@BpaulinUpfitBundle" quotes="true"/>
        </SymfonyConsole>
    </target>

    <target name="check:lint:php">
        <phplint interpreter="${path.php}" haltonfailure="true">
            <fileset dir="src">
                <include name="**/*.php"/>
            </fileset>
        </phplint>
    </target>

    <target name="check:base"
            depends="check:base:schema">
    </target>

    <target name="check:base:schema">
        <SymfonyConsole command="doctrine:schema:validate">
        </SymfonyConsole>
    </target>

    <target name="check:test">
        <exec command="${path.php} bin/phpunit -c app"
              passthru="true"
              checkreturn="true" />
    </target>

    <target name="check:behat">
        <exec command="${path.php} bin/behat --ansi --expand @BpaulinUpfitBundle"
              passthru="true"
              checkreturn="true" />
    </target>

    <target name="check"
            depends="check:lint,check:style,check:base,check:test,check:behat">
    </target>

</project>
